@using Shop.Model

@{
    ViewBag.Title = ViewBag.SearchTitle ?? "药品列表";
    Layout = "~/Areas/Phone/Views/Shared/_Layout.cshtml";
}

<header class="tc header">

    @{
        if (ViewBag.Tag != null)
        {
            var tag = ViewBag.Tag as Tag;
            <a href='@Url.RouteUrl("Phone_commodity")' class="goback"></a>
            <h2>@tag.Tag_Name</h2>
        }
        else
        {
            <a href='@Url.RouteUrl("Phone_yaoSearch")' class="goback"></a>
            <h2>搜索结果</h2>
        }
    }

</header>
<input id="tag-id" type="hidden" value="@ViewBag.TagId" />
<input id="search-key" type="hidden" value="@ViewBag.Search" />
<div class="main pro">
    <div class="order dis-flex tc">
        <a onclick="searchData(this)" class="on tag-price up"><span>价格</span><i class="fa fa-long-arrow-down"></i></a>
        <a onclick="searchData(this)" class="tag-discount"><span>折扣</span><i class="fa fa-long-arrow-down"></i></a>
        <a onclick="searchData(this)" class="tag-sales"><span>销量</span><i class="fa fa-long-arrow-down"></i></a>
    </div>
    <div class="rows">
        <dl class="pro-wrapper clearfix commodity-list">
            
        </dl>
    </div>
</div>
@section Js
    {
    <script type="text/javascript">
        var para = {};
        para.pageNum = 1, para.numPerPage = 20, para.sortName = '', para.sortOrder = '', para.search = '';
        var loadCommodityList = function (para,isloadMore) {
            $.ajax({
                url: "/Phone/Commodity/CommodityItemList",
                data: para,
                success: function (data) {
                    if (isloadMore) {
                        //加载更多 就追加
                        $('.loadmoreDiv').remove();
                        $('.commodity-list').append(data).show(500);
                      
                    } else {
                        //搜索
                        $('.commodity-list').html(data).show(500);
                    }
                    
                }
            });
        }

        var defaultTagId = $('#tag-id').val();
        var searchKey = $('#search-key').val().trim();
        para.tagId = defaultTagId||0;
        para.search = searchKey;
        $(function () {
            loadCommodityList(para);
        });

        var searchData=function(self,isLoadMore) {
            if (self) {
                var $self = $(self);
                //确定排序规则
                if (!isLoadMore) {
                    if ($self.hasClass('on')) {
                        if ($self.hasClass('up')) {
                            $self.removeClass('up').addClass('down');
                            para.sortOrder = 'Desc';
                        } else {
                            $self.removeClass('down').addClass('up');
                            para.sortOrder = 'Asc';
                        }
                    } else {
                        $self.addClass('on').addClass('up').siblings().removeClass('on');
                        para.sortOrder = 'Asc';
                    }
                }
                
                //确定排序字段
                if ($self.hasClass('tag-price')) {
                    para.sortName = 'Commodity_CostPrice';
                } else if ($self.hasClass('tag-discount')) {
                    para.sortName = 'Commodity_Discount';
                } else if ($self.hasClass('tag-sales')) {
                    para.sortName = 'Commodity_Sales';
                }

                loadCommodityList(para,isLoadMore);

            }
        }

        var loadMore=function() {
            var self = $('.order a[class=on]');
            para.pageNum += 1;
            searchData(self, true);
        }

    </script>
}